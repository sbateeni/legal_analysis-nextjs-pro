# مكونات الدردشة (Chat Components)

تم تقسيم صفحة الدردشة إلى مكونات منفصلة لسهولة الصيانة والتطوير.

## هيكل الملفات

```
components/chat/
├── index.ts                 # تصدير جميع المكونات والأنواع
├── types.ts                 # تعريفات الأنواع المشتركة
├── utils.ts                 # الدوال المساعدة والتحليل
├── MessageBubble.tsx        # مكون فقاعة الرسالة
├── QuickActions.tsx         # مكون الأزرار السريعة
├── AnalyticsPanel.tsx       # مكون لوحة التحليلات
├── Sidebar.tsx              # مكون الشريط الجانبي
├── ChatInput.tsx            # مكون حقل الإدخال
├── ChatHeader.tsx           # مكون رأس المحادثة
└── hooks/
    ├── useChatLogic.ts      # منطق الدردشة الرئيسي
    └── usePWA.ts            # منطق التطبيق التقدمي
```

## المكونات

### 1. MessageBubble
- عرض فقاعات الرسائل (المستخدم والمساعد)
- دعم عرض JSON منسق
- عرض المصادر القانونية والاقتراحات
- مؤشر مستوى الثقة

### 2. QuickActions
- أزرار الإجراءات السريعة
- استخراج الوقائع، الأساس القانوني، إلخ
- تصميم متجاوب (موبايل/ديسكتوب)

### 3. AnalyticsPanel
- عرض التحليلات والإحصائيات
- التحليل التنبؤي للقضايا
- أنواع القضايا والمراحل الأكثر استخداماً
- المشاكل الشائعة

### 4. Sidebar
- سياق القضية المختارة
- الإحصائيات السريعة
- التحليل التنبؤي للقضية المحددة
- الأزرار السريعة (ديسكتوب فقط)

### 5. ChatInput
- حقل إدخال الرسائل
- أزرار الإرسال والإيقاف
- الأزرار السريعة (موبايل فقط)
- تغيير حجم الحقل تلقائياً

### 6. ChatHeader
- رأس المحادثة مع العنوان
- أزرار التحكم (عرض التحليلات، نسخ، حفظ، إلخ)
- اختيار وضع الدردشة (قانوني/عام)
- معلومات القضية المختارة

## الـ Hooks

### 1. useChatLogic
- إدارة حالة الدردشة الكاملة
- منطق إرسال الرسائل
- تحميل وحفظ البيانات
- الدوال المساعدة للتحليل

### 2. usePWA
- إدارة تثبيت التطبيق كتطبيق أيقونة
- عرض زر التثبيت
- معالجة أحداث التثبيت

## الأنواع (Types)

### ChatMessage
```typescript
interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
  suggestions?: string[];
  nextSteps?: string[];
  confidence?: number;
  legalSources?: Array<{
    title: string;
    source: string;
    url: string;
    type: string;
  }>;
}
```

### AnalyticsData
```typescript
interface AnalyticsData {
  totalCases: number;
  successRate: number;
  predictiveAnalyses: PredictiveAnalysis[];
  // ... المزيد من الخصائص
}
```

## الدوال المساعدة (Utils)

### determineCaseType
- تحديد نوع القضية بناءً على النص
- دعم 8 أنواع مختلفة من القضايا
- تحليل ذكي للكلمات المفتاحية

### analyzeCases
- تحليل البيانات الإحصائية
- حساب معدلات النجاح
- إنتاج التحليلات التنبؤية

## الاستخدام

```tsx
import { 
  MessageBubble, 
  useChatLogic, 
  usePWA 
} from '../components/chat';

function MyComponent() {
  const chatLogic = useChatLogic();
  const pwa = usePWA();
  
  return (
    <div>
      {/* استخدام المكونات */}
    </div>
  );
}
```

## المميزات

✅ **تقسيم منطقي**: كل مكون له مسؤولية محددة  
✅ **قابلية إعادة الاستخدام**: يمكن استخدام المكونات في أماكن أخرى  
✅ **سهولة الصيانة**: تعديل مكون واحد لا يؤثر على الباقي  
✅ **اختبار أسهل**: يمكن اختبار كل مكون منفصلاً  
✅ **أداء أفضل**: تحميل مكونات فقط عند الحاجة  
✅ **كود أنظف**: فصل المنطق عن العرض  

## التطوير المستقبلي

- إضافة المزيد من المكونات المتخصصة
- تحسين أداء التحميل
- إضافة المزيد من الاختبارات
- تحسين إمكانية الوصول
