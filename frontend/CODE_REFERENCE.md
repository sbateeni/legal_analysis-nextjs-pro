# مرجعية الكود - منصة التحليل القانوني الذكي

## 📋 نظرة عامة على المشروع

منصة متقدمة للتحليل القانوني باستخدام الذكاء الاصطناعي، مصممة خصيصاً للنظام القانوني الفلسطيني. المنصة تدعم 13 مرحلة تحليل متسلسلة ومتراكمة مع ميزات متقدمة مثل المساعد القانوني الفلسطيني ونظام التحليلات.

## 🏗️ بنية المشروع

```
frontend/
├── pages/               # صفحات Next.js
│   ├── index.tsx        # الصفحة الرئيسية - تحليل القضايا
│   ├── chat.tsx         # المساعد القانوني الفلسطيني
│   ├── analytics.tsx    # التحليلات والإحصائيات
│   ├── history.tsx      # سجل القضايا
│   ├── about.tsx        # معلومات التطبيق
│   ├── privacy.tsx      # سياسة الخصوصية
│   ├── kb.tsx           # قاعدة المعرفة القانونية
│   ├── templates.tsx    # قوالب القضايا
│   ├── exports.tsx      # تصدير واستيراد البيانات
│   ├── settings.tsx     # إعدادات التطبيق
│   ├── _app.tsx         # إعدادات التطبيق الرئيسية
│   ├── _document.tsx    # إعدادات HTML
│   └── api/            # نقاط النهاية API
│       ├── analyze.ts   # تحليل قانوني
│       ├── chat.ts      # مساعد ذكي
│       ├── analytics.ts # إحصائيات
│       ├── legal-kb.ts  # قاعدة المعرفة
│       └── legal-news.ts # الأخبار القانونية
├── components/          # مكونات React
│   ├── Header.tsx       # رأس الصفحة
│   ├── Layout.tsx       # تخطيط الصفحة
│   ├── ArticleCard.tsx  # بطاقة المقال
│   ├── LegalNews.tsx    # الأخبار القانونية
│   ├── AdvancedFeatures.tsx # الميزات المتقدمة
│   ├── MobileNav.tsx    # التنقل في الجوال
│   ├── Notifications.tsx # الإشعارات
│   └── UI.tsx           # مكونات واجهة المستخدم
├── lib/                 # واجهة موحدة لإعادة التصدير (من utils)
│   └── index.ts         # re-exports فقط، لا تغييرات سلوكية
├── contexts/            # سياقات React
│   └── ThemeContext.tsx # سياق الثيم
├── utils/              # الأدوات المساعدة
│   ├── db.ts           # قاعدة البيانات الرئيسية
│   ├── db.dexie.ts     # قاعدة البيانات المحلية
│   ├── crypto.ts       # التشفير والأمان
│   ├── validation.ts   # التحقق من صحة البيانات
│   ├── cache.ts        # التخزين المؤقت
│   ├── chatCache.ts    # تخزين المحادثات
│   ├── prompts.ts      # النصوص الموجهة للذكاء الاصطناعي
│   ├── mobile.ts       # ميزات الجوال
│   ├── security.ts     # الأمان والحماية
│   ├── learning.ts     # التعلم والتحسين
│   ├── metrics.ts      # المقاييس والإحصائيات
│   ├── export.ts       # تصدير البيانات
│   ├── exportSettings.ts # إعدادات التصدير
│   ├── appSettings.ts  # إعدادات التطبيق
│   ├── errors.ts       # معالجة الأخطاء
│   ├── schemas.ts      # مخططات البيانات
│   └── theme.ts        # إدارة الثيمات
├── types/              # تعريفات TypeScript
│   └── analysis.ts     # أنواع التحليل القانوني
├── stages/             # مراحل التحليل
│   ├── index.ts        # تصدير المراحل
│   └── stage*.json     # ملفات المراحل (1-13)
├── public/             # الملفات العامة
│   ├── manifest.json   # PWA
│   ├── sw.js          # Service Worker
│   ├── icon-*.svg     # الأيقونات
│   └── robots.txt     # ملف الروبوتات
├── styles/             # ملفات CSS
│   ├── globals.css     # الأنماط العامة
│   └── responsive.css  # الأنماط المتجاوبة
├── tests/              # اختبارات الوحدة
│   ├── api_chat.test.ts
│   ├── chatCache.test.ts
│   ├── safety.test.ts
│   └── schemas.test.ts
├── tests/
│   ├── unit/           # اختبارات الوحدة
│   └── e2e/            # اختبارات النهاية
│       └── basic.spec.ts
└── package.json        # التبعيات والإعدادات
```

## 🚀 الميزات الرئيسية

### 1. التحليل القانوني المتقدم
- **13 مرحلة تحليل متسلسلة ومتراكمة**
- كل مرحلة تعتمد على نتائج السابقة
- تغطية شاملة للجوانب القانونية
- دعم النصوص العربية واللغة القانونية

### 2. المساعد القانوني الفلسطيني
- **محادثة تفاعلية متخصصة**
- إجابات مبنية على القوانين الفلسطينية
- اقتراحات وخطوات تالية
- مستوى ثقة للإجابات
- حفظ الاستراتيجيات في قاعدة المعرفة

### 3. نظام التحليلات والإحصائيات
- **إحصائيات مفصلة للقضايا**
- تحليل أنواع القضايا (مدنية، جنائية، أحوال شخصية، إلخ)
- معدل الإنجاز والنجاح
- النشاط الأخير والاتجاهات
- رسوم بيانية تفاعلية

### 4. قاعدة المعرفة القانونية
- **حفظ الاستراتيجيات القانونية**
- إعادة استخدام الحلول
- تصنيف بالموضوعات والوسوم
- البحث والتصفية المتقدم
- تصدير واستيراد المعرفة

### 5. التطبيق التقدمي (PWA)
- **تثبيت كتطبيق على الهاتف**
- عمل بدون إنترنت (للبيانات المحفوظة)
- إشعارات ذكية
- تجربة تطبيق محسنة
- دعم جميع الأجهزة

### 6. حماية الخصوصية والأمان
- **جميع البيانات محفوظة محلياً**
- تشفير متقدم للبيانات الحساسة
- حماية من هجمات XSS و SQL Injection
- لا يتم إرسال أي بيانات إلى خوادم خارجية

## 📱 الصفحات والوظائف

### الصفحة الرئيسية (`index.tsx`)
- إدخال مفتاح Gemini API
- إنشاء قضية جديدة
- اختيار مرحلة التحليل
- عرض النتائج
- حفظ القضية

### المساعد القانوني (`chat.tsx`)
- محادثة تفاعلية مع AI
- اختيار قضية محددة (اختياري)
- حفظ المحادثات
- نسخ المحادثة كاملة
- حفظ الاستراتيجيات

### التحليلات (`analytics.tsx`)
- إحصائيات شاملة
- تحليل أنواع القضايا
- معدلات الإنجاز
- النشاط الزمني
- الرسوم البيانية

### سجل القضايا (`history.tsx`)
- عرض القضايا المحفوظة
- البحث والتصفية
- تصدير واستيراد
- حذف القضايا

### قاعدة المعرفة (`kb.tsx`)
- عرض الاستراتيجيات
- البحث والتصفية
- إضافة استراتيجيات جديدة
- تحرير وحذف

## 🔧 التقنيات المستخدمة

### Frontend
- **Next.js 15**: إطار العمل الرئيسي
- **React 18**: مكتبة واجهة المستخدم
- **TypeScript**: الأمان والتنظيم
- **CSS Modules**: تنسيق المكونات

### الذكاء الاصطناعي
- **Google Gemini AI**: للتحليل القانوني
- **نصوص موجهة متخصصة**: للقانون الفلسطيني
- **معالجة اللغة العربية**: دعم كامل للعربية

### التخزين
- **IndexedDB**: قاعدة بيانات المتصفح
- **Dexie.js**: واجهة مبسطة لـ IndexedDB
- **LocalStorage**: تخزين مؤقت

### PWA
- **Service Worker**: العمل بدون إنترنت
- **Web App Manifest**: تثبيت التطبيق
- **Push Notifications**: الإشعارات

## 📊 مراحل التحليل القانوني

1. **تحديد المشكلة القانونية** - فهم جوهر القضية
2. **جمع المعلومات والوثائق** - تجميع الأدلة والوثائق
3. **تحليل النصوص القانونية** - فهم النصوص التشريعية
4. **تحديد القواعد القانونية المنطبقة** - تحديد القانون المطبق
5. **تحليل السوابق القضائية** - دراسة الأحكام السابقة
6. **تحليل الفقه القانوني** - آراء الفقهاء
7. **تحليل الظروف الواقعية** - فهم الواقع العملي
8. **تحديد الحلول القانونية الممكنة** - خيارات متعددة
9. **تقييم الحلول القانونية** - تحليل الإيجابيات والسلبيات
10. **اختيار الحل الأمثل** - أفضل خيار
11. **صياغة الحل القانوني** - صياغة قانونية
12. **تقديم التوصيات** - نصائح عملية
13. **العريضة القانونية النهائية** - الوثيقة النهائية

## 🔐 الأمان والخصوصية

### حماية البيانات
- تشفير متقدم للبيانات الحساسة
- تخزين محلي فقط (لا خوادم خارجية)
- حماية من هجمات الويب الشائعة

### الخصوصية
- لا جمع للبيانات الشخصية
- لا تتبع للمستخدمين
- تحكم كامل في البيانات

### التشفير
- مفاتيح تشفير قوية
- تشفير البيانات المحفوظة
- حماية مفاتيح API

## 🚀 النشر والتوزيع

### Vercel (موصى به)
```bash
npm install -g vercel
vercel login
vercel --prod
```

### متغيرات البيئة المطلوبة
```env
GOOGLE_API_KEY=your_gemini_api_key
NEXT_PUBLIC_ENCRYPTION_SECRET=your_secret_key
```

### بناء الإنتاج
```bash
npm run build
npm start
```

## 🧪 الاختبارات

### اختبارات الوحدة
```bash
npm run test
```

### اختبارات النهاية
```bash
npm run test:e2e
```

### اختبارات الأداء
```bash
npm run build
npm run start
# ثم فتح http://localhost:3000/web-vitals
```

## 🛠️ إصلاح المشاكل الشائعة

### 1. مشاكل Content Security Policy (CSP)
**المشكلة**: رفض تحميل الخطوط من Google Fonts
**الحل**: تحديث `next.config.ts` لإضافة:
```typescript
"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
"font-src 'self' data: https://fonts.gstatic.com",
"connect-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com"
```

### 2. مشاكل الخطوط
**المشكلة**: عدم تحميل الخطوط العربية والإنجليزية
**الحل**: إضافة في `_document.tsx`:
```typescript
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
```

### 3. مشاكل PWA Manifest
**المشكلة**: أيقونات غير صالحة في manifest.json
**الحل**: استبدال الأيقونات المشفرة بـ SVG:
```json
{
  "src": "/icon-192x192.svg",
  "type": "image/svg+xml"
}
```

### 4. مشاكل API
**المشكلة**: أخطاء 500 في API الأخبار القانونية
**الحل**: 
- إضافة معالجة أخطاء أفضل
- إضافة User-Agent headers
- معالجة فشل الاتصال بالمصدر

### 5. مشاكل Favicon
**المشكلة**: خطأ 404 في favicon.ico
**الحل**: إنشاء ملف favicon.ico صالح في مجلد public

### 6. أخطاء ESLint في البناء
**المشكلة**: فشل البناء بسبب أخطاء ESLint
**الحلول**:

#### أ. علامات اقتباس غير محمية
**المشكلة**: `"` can be escaped with `&quot;`
**الحل**: استبدال `"` بـ `&quot;` في النصوص العربية
```typescript
// بدلاً من:
<li>اضغط على "ابدأ التحليل"</li>

// استخدم:
<li>اضغط على &quot;ابدأ التحليل&quot;</li>
```

#### ب. dependencies مفقودة في useEffect
**المشكلة**: React Hook useEffect has a missing dependency
**الحل**: إضافة المتغيرات المفقودة إلى dependency array
```typescript
useEffect(() => {
  // الكود
}, [fetchNews, apiKey]); // أضف apiKey هنا
```

#### ج. إعدادات ESLint
**الحل**: يمكن تعديل قواعد ESLint في `eslint.config.mjs`:
```javascript
rules: {
  'react/no-unescaped-entities': 'warn', // تحذير بدلاً من خطأ
  'react-hooks/exhaustive-deps': 'warn'
}
```

## 📈 التطوير المستقبلي

### الميزات المخطط لها
- [ ] دعم لغات قانونية إضافية
- [ ] تكامل مع أنظمة المحاكم
- [ ] تحليل الصور والوثائق
- [ ] نظام تعاون متعدد المستخدمين
- [ ] تطبيق جوال أصلي

### التحسينات التقنية
- [ ] تحسين الأداء
- [ ] دعم المزيد من نماذج AI
- [ ] تحسين دقة التحليل
- [ ] واجهة مستخدم محسنة

## 🤝 المساهمة

### كيفية المساهمة
1. Fork المشروع
2. إنشاء فرع للميزة الجديدة
3. إجراء التغييرات
4. إرسال Pull Request

### معايير الكود
- استخدام TypeScript
- اتباع معايير ESLint
- كتابة اختبارات للميزات الجديدة
- تحديث التوثيق

## 📞 الدعم والاتصال

### الدعم الفني
- افتح Issue في GitHub
- راجع ملفات التوثيق
- تحقق من إعدادات البيئة

### التحديثات
- تابع التحديثات في GitHub
- راجع ملف CHANGELOG
- انضم إلى قائمة البريد الإلكتروني

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT.

---

**آخر تحديث**: ديسمبر 2024  
**الإصدار**: 2.0.0  
**المطور**: فريق منصة التحليل القانوني الذكي
