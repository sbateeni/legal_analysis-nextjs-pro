# دليل تشغيل اختبار RAG 🚀

## 🎯 الهدف
اختبار نظام RAG للقوانين الفلسطينية قبل الدمج الكامل مع النظام الرئيسي.

## 📋 المتطلبات
- Python 3.8+ مثبت
- المكتبات المطلوبة: `flask`, `flask-cors`, `sentence-transformers`
- ملف `corpus.jsonl` جاهز (147 وثيقة قانونية)

## 🚀 خطوات التشغيل

### 1. **تشغيل خادم RAG**
```bash
# الانتقال إلى مجلد crawler
cd crawler

# تشغيل خادم RAG
python legal_api_simple.py --corpus out/corpus.jsonl --port 5001 --debug
```

**النتيجة المتوقعة:**
```
🔧 تهيئة نظام RAG مع المجموعة: out/corpus.jsonl
✅ تم تحميل نموذج Embeddings بنجاح
📚 تحميل مجموعة القوانين من out\corpus.jsonl
✅ تم تحميل 147 وثيقة قانونية
🔧 بناء Embeddings...
✅ تم تهيئة النظام بنجاح
🚀 تشغيل خادم API على http://localhost:5001
```

### 2. **تشغيل النظام الرئيسي**
```bash
# في terminal جديد، الانتقال إلى مجلد frontend
cd frontend

# تشغيل خادم التطوير
npm run dev
```

**النتيجة المتوقعة:**
```
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

### 3. **اختبار النظام**
1. افتح المتصفح على: `http://localhost:3000`
2. اذهب إلى: `http://localhost:3000/rag-test`
3. اضغط على "فحص الحالة" للتأكد من الاتصال بـ RAG
4. جرب البحث باستخدام الأمثلة المقدمة

## 🔍 أمثلة للاختبار

### استعلامات جيدة (نتائج متوقعة):
- ✅ "قانون الملكية العقارية" - تشابه عالي
- ✅ "الجرائم الاقتصادية" - تشابه جيد
- ✅ "حقوق العمال" - تشابه متوسط

### استعلامات ضعيفة (نتائج متوقعة):
- ⚠️ "الطلاق والخلع" - تشابه منخفض
- ⚠️ "قانون الإجراءات المدنية" - قد يحتاج تحسين

## 📊 قياسات الأداء

### سرعة الاستجابة:
- **البحث العادي**: < 2 ثانية
- **الحصول على السياق**: < 3 ثانية
- **قائمة الوثائق**: < 1 ثانية

### دقة النتائج:
- **تشابه عالي**: > 0.5 (50%)
- **تشابه جيد**: 0.3 - 0.5 (30-50%)
- **تشابه ضعيف**: < 0.3 (30%)

## 🛠️ استكشاف الأخطاء

### مشكلة: "لا يمكن الاتصال بخادم RAG"
**الحل:**
1. تأكد من تشغيل `legal_api_simple.py`
2. تحقق من المنفذ 5001
3. تأكد من عدم وجود حظر في الجدار الناري

### مشكلة: "نظام RAG غير جاهز"
**الحل:**
1. انتظر حتى يكتمل بناء Embeddings
2. تحقق من وجود ملف `corpus.jsonl`
3. تأكد من تثبيت `sentence-transformers`

### مشكلة: "خطأ في البحث"
**الحل:**
1. تحقق من صحة الاستعلام (غير فارغ)
2. تأكد من الاتصال بالإنترنت
3. راجع سجلات الخادم

## 🎯 الاختبارات المطلوبة

### 1. **اختبار الاتصال**
- [ ] فحص حالة RAG يعمل
- [ ] عرض عدد الوثائق (147)
- [ ] التأكد من جاهزية Embeddings

### 2. **اختبار البحث**
- [ ] البحث بـ "قانون الملكية العقارية"
- [ ] البحث بـ "الجرائم الاقتصادية"
- [ ] البحث بـ "حقوق العمال"

### 3. **اختبار السياق**
- [ ] الحصول على السياق القانوني
- [ ] عرض القوانين ذات الصلة
- [ ] عرض الأحكام القضائية

### 4. **اختبار الواجهة**
- [ ] عرض النتائج بشكل صحيح
- [ ] روابط المصادر تعمل
- [ ] أمثلة الاختبار تعمل

## 📈 التحسينات المقترحة

### قصيرة المدى:
1. **تحسين دقة البحث** للاستعلامات الضعيفة
2. **إضافة المزيد من الأمثلة** للاختبار
3. **تحسين عرض النتائج** مع تصنيف أفضل

### متوسطة المدى:
1. **إضافة المزيد من المصادر** (500+ قانون)
2. **تحسين Embeddings** باستخدام نموذج أفضل
3. **إضافة تصنيف تلقائي** للوثائق

### طويلة المدى:
1. **دمج مع النظام الرئيسي**
2. **إضافة تحديث تلقائي** للقوانين
3. **واجهة إدارة متقدمة**

## 🎉 النتيجة المتوقعة

بعد الاختبار الناجح، ستحصل على:
- ✅ **نظام RAG يعمل بشكل مثالي**
- ✅ **بحث دلالي سريع ودقيق**
- ✅ **سياق قانوني غني**
- ✅ **أساس قوي للدمج الكامل**

**هذا الاختبار سيضمن أن RAG جاهز للدمج مع النظام الرئيسي!** 🏛️✨
