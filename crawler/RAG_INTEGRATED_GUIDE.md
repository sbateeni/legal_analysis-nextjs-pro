# دليل تشغيل نظام RAG المتكامل 🚀

## 🎯 الهدف
تشغيل نظام RAG للقوانين الفلسطينية كجزء متكامل من النظام الرئيسي.

## 📋 المتطلبات
- Python 3.8+ مثبت
- المكتبات المطلوبة: `flask`, `flask-cors`, `sentence-transformers`
- ملف `corpus.jsonl` جاهز (147 وثيقة قانونية)
- Node.js و npm مثبتان

## 🚀 خطوات التشغيل

### 1. **تشغيل خادم RAG**
```bash
# الانتقال إلى مجلد crawler
cd crawler

# تشغيل خادم RAG
python legal_api_simple.py --corpus out/corpus.jsonl --port 5001 --debug
```

**النتيجة المتوقعة:**
```
🔧 تهيئة نظام RAG مع المجموعة: out/corpus.jsonl
✅ تم تحميل نموذج Embeddings بنجاح
📚 تحميل مجموعة القوانين من out\corpus.jsonl
✅ تم تحميل 147 وثيقة قانونية
🔧 بناء Embeddings...
✅ تم تهيئة النظام بنجاح
🚀 تشغيل خادم API على http://localhost:5001
```

### 2. **تشغيل النظام الرئيسي**
```bash
# في terminal جديد، الانتقال إلى مجلد frontend
cd frontend

# تشغيل خادم التطوير
npm run dev
```

**النتيجة المتوقعة:**
```
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

### 3. **اختبار النظام**
1. افتح المتصفح على: `http://localhost:3000`
2. اذهب إلى: `http://localhost:3000/rag`
3. اضغط على "فحص الحالة" للتأكد من الاتصال بـ RAG
4. جرب البحث باستخدام الأمثلة المقدمة

## 🔍 المميزات الجديدة

### ✅ **صفحة RAG متكاملة**
- واجهة محسنة ومتجاوبة
- فحص حالة الاتصال التلقائي
- عرض النتائج بتنسيق جميل
- إمكانية عرض الوثائق الكاملة

### ✅ **API Endpoints متكاملة**
- `/api/rag/health` - فحص حالة RAG
- `/api/rag/search` - البحث في القوانين
- `/api/rag/context` - الحصول على السياق القانوني
- `/api/rag/documents` - قائمة الوثائق
- `/api/rag/document/[docId]` - وثيقة محددة

### ✅ **ربط مع النظام الرئيسي**
- رابط في القائمة الجانبية
- تصميم متسق مع باقي الصفحات
- معالجة أخطاء شاملة

## 🔍 أمثلة للاختبار

### استعلامات جيدة (نتائج متوقعة):
- ✅ "قانون الملكية العقارية" - تشابه عالي (55%)
- ✅ "الجرائم الاقتصادية" - تشابه جيد (53%)
- ✅ "حقوق العمال" - تشابه متوسط (40%)

### استعلامات ضعيفة (نتائج متوقعة):
- ⚠️ "الطلاق والخلع" - تشابه منخفض (32%)
- ⚠️ "قانون الإجراءات المدنية" - قد يحتاج تحسين

## 📊 قياسات الأداء

### سرعة الاستجابة:
- **فحص الحالة**: < 1 ثانية
- **البحث العادي**: < 2 ثانية
- **الحصول على السياق**: < 3 ثانية
- **قائمة الوثائق**: < 1 ثانية
- **عرض وثيقة**: < 1 ثانية

### دقة النتائج:
- **تشابه عالي**: > 0.5 (50%)
- **تشابه جيد**: 0.3 - 0.5 (30-50%)
- **تشابه ضعيف**: < 0.3 (30%)

## 🛠️ استكشاف الأخطاء

### مشكلة: "لا يمكن الاتصال بخادم RAG"
**الحل:**
1. تأكد من تشغيل `legal_api_simple.py`
2. تحقق من المنفذ 5001
3. تأكد من عدم وجود حظر في الجدار الناري

### مشكلة: "نظام RAG غير جاهز"
**الحل:**
1. انتظر حتى يكتمل بناء Embeddings
2. تحقق من وجود ملف `corpus.jsonl`
3. تأكد من تثبيت `sentence-transformers`

### مشكلة: "خطأ في البحث"
**الحل:**
1. تحقق من صحة الاستعلام (غير فارغ)
2. تأكد من الاتصال بالإنترنت
3. راجع سجلات الخادم

## 🎯 الاختبارات المطلوبة

### 1. **اختبار الاتصال**
- [ ] فحص حالة RAG يعمل
- [ ] عرض عدد الوثائق (147)
- [ ] التأكد من جاهزية Embeddings

### 2. **اختبار البحث**
- [ ] البحث بـ "قانون الملكية العقارية"
- [ ] البحث بـ "الجرائم الاقتصادية"
- [ ] البحث بـ "حقوق العمال"

### 3. **اختبار السياق**
- [ ] الحصول على السياق القانوني
- [ ] عرض القوانين ذات الصلة
- [ ] عرض الأحكام القضائية

### 4. **اختبار الواجهة**
- [ ] عرض النتائج بشكل صحيح
- [ ] عرض الوثائق الكاملة
- [ ] أمثلة الاختبار تعمل

### 5. **اختبار التكامل**
- [ ] القائمة الجانبية تعمل
- [ ] التنقل بين الصفحات
- [ ] معالجة الأخطاء

## 📈 التحسينات المقترحة

### قصيرة المدى:
1. **تحسين دقة البحث** للاستعلامات الضعيفة
2. **إضافة المزيد من الأمثلة** للاختبار
3. **تحسين عرض النتائج** مع تصنيف أفضل

### متوسطة المدى:
1. **إضافة المزيد من المصادر** (500+ قانون)
2. **تحسين Embeddings** باستخدام نموذج أفضل
3. **إضافة تصنيف تلقائي** للوثائق

### طويلة المدى:
1. **دمج مع نظام التحليل** الرئيسي
2. **إضافة تحديث تلقائي** للقوانين
3. **واجهة إدارة متقدمة**

## 🎉 النتيجة المتوقعة

بعد التشغيل الناجح، ستحصل على:
- ✅ **نظام RAG متكامل** مع النظام الرئيسي
- ✅ **واجهة محسنة** وسهلة الاستخدام
- ✅ **بحث دلالي سريع ودقيق**
- ✅ **سياق قانوني غني**
- ✅ **أساس قوي للدمج الكامل**

**هذا النظام جاهز للاستخدام والدمج مع باقي الميزات!** 🏛️✨
